# plot_broadcast.py

import matplotlib.pyplot as plt

# 4 MPI 
sizes = [
    8, 16, 32, 64, 128, 256, 512, 1024,
    2048, 4096, 8192, 16384, 32768, 65536,
    131072, 262144, 524288, 1048576,
    2097152, 4194304, 8388608, 16777216,
    33554432, 67108864, 134217728, 268435456
]

my_bw_4  = [
    0.464782, 37.126,   29.3156, 103.274,  3.97416, 41.108,  89.1349,  68.0958,
    139.699,  213.375,  359.162,  376.116, 408.31,  489.651, 506.994,  105.388,
    344.955,  323.08,   467.176,  749.614, 1108.99, 1441.67, 1709.77,  1865.61,
    1997.32,  1841.09
]

mpi_bw_4 = [
    0.259195, 28.7359,  51.6372,  21.3858, 17.9252, 59.8824,  46.5651, 138.697,
    404.625,  399.208,  12.9102,   54.217, 56.0135, 185.153,  136.978, 4280.97,
    4810.14,  4097.74,  7493.39, 10273.6, 12525.8, 13969.0, 14111.1, 14988.9,
    16548.2, 12687.4
]

# 32 MPI
my_bw_32  = [
    0.312207, 2.3439, 0.329959, 1.43363, 0.33489, 2.12383, 4.04971, 8.40162,
    20.6542, 18.069, 31.0132, 36.4802, 39.0549, 44.7993, 45.088, 121.922,
    274.328, 279.579, 279.245, 269.42, 270.081, 280.172, 241.058,  249.636,
    259.54, 266.434
]

mpi_bw_32 = [
    0.0476355, 13.5996, 33.499, 67.6665, 10.7485, 21.495, 23.7942, 38.3733,
    11.4906, 117.407, 20.8008, 448.569, 715.66, 699.066, 849.173, 11229.4,
    15309.7, 17056.4, 12032.2, 9970.46, 8378.81, 3981.47, 2069.57, 6650.49,
    6201.54, 6460.39
]
# -------------------------------------------------------------------

# 绘制两组图：p=4 和 p=32
for p, my_bw, mpi_bw in [(4, my_bw_4, mpi_bw_4), (32, my_bw_32, mpi_bw_32)]:
    plt.figure()
    plt.plot(sizes, my_bw,  marker='o', linestyle='-', label=f'my_broadcast (p={p})')
    plt.plot(sizes, mpi_bw, marker='s', linestyle='--', label=f'MPI_Bcast (p={p})')
    plt.xscale('log', base=2)
    plt.yscale('log')
    plt.xlabel('Message Size (bytes)')
    plt.ylabel('Bandwidth (MB/s)')
    plt.title(f'Broadcast Comparison with {p} MPI Processes')
    plt.grid(True, which='both')
    plt.legend()
    plt.tight_layout()
    plt.savefig(f'broadcast_comparison_p{p}.png')
    print(f"Saved plot: broadcast_comparison_p{p}.png")
